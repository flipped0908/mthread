#  用两阶段终止模式终止监控操作


实际工作中，有些监控系统需要动态地采集一些数据，一般都是监控系统发送采集指令给被监控系统的监控代理，监控代理接 收到指令之后，
从监控目标收集数据，然后回传给监控系统，详细过程如下图所示。出于对性能的考虑(有些监控项对系统性 能影响很大，所以不能一直持续监控)，动态采集功能一般都会有终止操作。



# 如何优雅地终止线程池  

线程池提供了两个方法:shutdown()和shutdownNow() 

shutdown()方法是一种很保守的关闭线程池的方法。线程池执行shutdown()后，就会拒绝接收新的任务，但是会等待线程池中 正在执行的任务和已经进入阻塞队列的任务都执行完之后才最终关闭线程池。

而shutdownNow()方法，相对就激进一些了，线程池执行shutdownNow()后，会拒绝接收新的任务，同时还会中断线程池中正 在执行的任务，已经进入阻塞队列的任务也被剥夺了执行的机会，
不过这些被剥夺执行机会的任务会作为shutdownNow()方法 的返回值返回。因为shutdownNow()方法会中断正在执行的线程，所以提交到线程池的任务，如果需要优雅地结束，就需要正 确地处理线程中断。

# 总结
两阶段终止模式是一种应用很广泛的并发设计模式，在Java语言中使用两阶段终止模式来优雅地终止线程，需要注意两个关 键点:一个是仅检查终止标志位是不够的，因为线程的状态可能处于休眠态;另一个是仅检查线程的中断状态也是不够的，因 为我们依赖的第三方类库很可能没有正确处理中断异常。
当你使用Java的线程池来管理线程的时候，需要依赖线程池提供的shutdown()和shutdownNow()方法来终止线程池。不过在使 用时需要注意它们的应用场景，尤其是在使用shutdownNow()的时候，一定要谨慎。